# Анализ документов театра "Приют Комедианта"

## Обзор

**Проанализировано:** 2 спектакля (34 Бесприданница, 39 Женитьба ППО)
**Всего файлов:** 1037
**Театр:** Государственный драматический театр «Приют Комедианта», Санкт-Петербург

---

## 1. Статистика по типам файлов

| Формат | Количество | Назначение |
|--------|------------|------------|
| MP3 | 367 | Музыкальное оформление спектакля |
| PDF | 281 | Сертификаты, планировки, официальные документы |
| WAV | 151 | Звуковые эффекты (высокое качество) |
| JPG/JPEG | 111 | Фото, сертификаты (сканы), эскизы |
| DOCX | 44 | Текстовые документы (описи, ТЗ, инструкции) |
| PNG | 21 | Фотографии декораций по сценам |
| WEBP | 12 | Сжатые изображения |
| XLSX | 9 | Сметы, калькуляции |
| DWG | 7 | Чертежи AutoCAD |
| DOC | 4 | Устаревшие текстовые документы |
| CUES | 5 | Проекты QLab (звуковые партитуры) |
| C2P | 3 | Проекты Capture (световые партитуры) |
| ESF3D | 2 | Шоу-файлы световых пультов |
| MP4 | 1 | Видеоконтент |

---

## 2. Иерархическая структура паспорта спектакля

### 1.0 Общая часть
```
├── 1.1 Титульный лист (паспорт спектакля)
├── 1.2 Видеозапись спектакля
├── 1.3 Акт приемки декораций (комиссия из 7 человек)
├── 1.4 Акты огнезащитной обработки + лицензии
├── 1.5 Расчеты конструкций (жёсткость, прочность)
├── 1.6 Акты приёмки сварочных работ
│   └── Свидетельства/удостоверения сварщиков (JPG сканы)
└── 1.7 Сертификаты материалов
    ├── Клей (PDF, JPG)
    ├── Краска (PDF, JPG)
    ├── Крепёж (PDF)
    ├── Металл (JPG сканы качества)
    ├── Ткань/Оксфорд (PDF)
    ├── Троса (PDF)
    └── Фанера (PDF)
```

### 2.0 Документация производства сценического оформления
```
├── 2.1 Эскизы к спектаклю (JPG - концепт-арт с персонажами)
├── 2.2 ТЗ декорация (DOCX/DOC)
├── 2.3 ТЗ свет (DOCX - список оборудования)
├── 2.4 ТЗ костюм (DOCX)
├── 2.5 ТЗ реквизит/бутафория (DOCX)
└── ТЗ от художника (PDF + эскизы элементов JPG)
```

### 3.0 Документация эксплуатации спектакля
```
├── 3.1 Фотографии декораций (PNG по актам/картинам)
├── 3.2 Планировки (PDF - AutoCAD выгрузки)
├── 3.3 Монтировочная опись (DOCX - таблица с категориями)
├── 3.4 Ведомость развески (DOCX)
├── 3.5 Монтировочная опись костюм (DOCX - детальная по ролям)
├── 3.6 Инструкция монтаж/демонтаж (DOCX)
├── 3.7 Инструкция по монтажу элементов
│   └── Изображения (PDF схемы сборки)
├── 3.8 Партитура света
│   ├── Направка фото (JPEG)
│   ├── Развес фото (JPEG)
│   ├── Развеска (PDF + C2P файлы Capture)
│   └── Шоу файл (ESF3D - экспорт пульта)
├── 3.9 Партитура звука
│   ├── audio/ (MP3, WAV)
│   ├── QLab проект (.cues)
│   ├── Концепция (DOCX - список треков)
│   ├── Оборудование (DOCX)
│   └── Выписка (PDF)
├── 3.10 Партитура видео (опционально)
├── 3.11 Ведомость по проведению (PDF)
└── 3.12 Грим-карта (DOCX - детальные инструкции)
```

### 4.0 Приложение
```
├── 4.1 Чертежи (DWG - AutoCAD)
├── 4.2 Эскизы, фото и прочее
├── 4.3 Райдер спектакля (DOCX - требования к площадке)
├── Сметы (XLSX, PDF)
└── Реквизит и бутафория (DOCX)
```

---

## 3. Категории документов для системы

### Группа A: Шаблоны (генерируются из данных)
Документы с placeholder'ами `{{переменная}}` для автозаполнения:

| Код | Название | Переменные |
|-----|----------|------------|
| `PASSPORT` | Паспорт спектакля | название, режиссёр, художник, дата_премьеры, состояние |
| `ACT_RECEPTION` | Акт приёмки | название, дата, комиссия[], заключение |
| `MOUNT_LIST_DECOR` | Монтировочная опись (декор) | название, категории[{код, наименование, кол-во}] |
| `MOUNT_LIST_COSTUME` | Монтировочная опись (костюм) | роли[{персонаж, предметы[]}] |
| `TECH_SPEC_*` | Техническое задание | название, раздел, описание, характеристики[] |
| `RIDER` | Райдер спектакля | название, продолжительность, требования_сцены, оборудование[] |
| `GRIM_CARD` | Грим-карта | актёры[], материалы[], инструкции_по_актам |
| `PROPS_LIST` | Перечень реквизита | категории[{код, наименование, кол-во, ед_изм}] |

### Группа B: Загружаемые файлы (уникальные)
Документы которые создаются внешними инструментами:

| Категория | Форматы | Описание |
|-----------|---------|----------|
| Эскизы | JPG, PNG | Концепт-арт от художника |
| Чертежи | DWG, PDF | AutoCAD проекты |
| Планировки | PDF | Выгрузки из AutoCAD |
| Сертификаты | PDF, JPG | Сканы официальных документов |
| Фото декораций | PNG, JPG | Фиксация по сценам |
| Партитура света | C2P, ESF3D, PDF | Capture проекты, экспорт пульта |
| Партитура звука | CUES, MP3, WAV | QLab проекты, аудиофайлы |
| Сметы | XLSX, PDF | Финансовые расчёты |
| Видео | MP4 | Записи спектакля |

### Группа C: Исходящий реквизит (расходники)
Потребляемые материалы на каждый спектакль:

- Продукты питания (яйца, колбаса, морс)
- Расходные материалы (салфетки, булавки)
- Косметика (пудра, лак для волос)

---

## 4. Структура категорий для автоклассификации

```yaml
performance_documents:
  passport:                    # Паспорт спектакля
    general:                   # 1.0 Общая часть
      - title_page            # Титульный лист
      - video_recording       # Видеозапись
      - reception_act         # Акт приёмки
      - fire_protection       # Огнезащита
      - calculations          # Расчёты
      - welding_acts          # Акты сварки
      - material_certs        # Сертификаты материалов

    production:               # 2.0 Производство
      - sketches              # Эскизы
      - tech_spec_decor       # ТЗ декорация
      - tech_spec_light       # ТЗ свет
      - tech_spec_costume     # ТЗ костюм
      - tech_spec_props       # ТЗ реквизит
      - artist_docs           # Документы от художника

    operation:                # 3.0 Эксплуатация
      - decor_photos          # Фото декораций
      - layouts               # Планировки
      - mount_list_decor      # Монтировка (декор)
      - mount_list_costume    # Монтировка (костюм)
      - hanging_list          # Ведомость развески
      - mount_instructions    # Инструкции монтажа
      - light_partition       # Партитура света
      - sound_partition       # Партитура звука
      - video_partition       # Партитура видео
      - conduct_sheet         # Ведомость проведения
      - makeup_card           # Грим-карта

    appendix:                 # 4.0 Приложение
      - drawings              # Чертежи
      - rider                 # Райдер
      - estimates             # Сметы
      - other                 # Прочее
```

---

## 5. Автоопределение категории по имени файла

### Паттерны для парсинга

```python
CATEGORY_PATTERNS = {
    # По номеру секции в имени
    r'^1\.[0-7]': 'general',
    r'^2\.[1-5]': 'production',
    r'^3\.[1-9]|3\.1[0-2]': 'operation',
    r'^4\.[1-3]': 'appendix',

    # По ключевым словам
    r'паспорт|passport': 'title_page',
    r'акт.*прием|reception': 'reception_act',
    r'огнезащит|fire': 'fire_protection',
    r'сварк|weld': 'welding_acts',
    r'сертификат|cert': 'material_certs',
    r'эскиз|sketch': 'sketches',
    r'тз|tech.*spec': 'tech_spec',
    r'декор': 'tech_spec_decor',
    r'свет|light': 'tech_spec_light',
    r'костюм|costume': 'tech_spec_costume',
    r'реквизит|бутафор|props': 'tech_spec_props',
    r'монтиров.*опись': 'mount_list',
    r'развеск': 'hanging_list',
    r'планировк|layout': 'layouts',
    r'партитура.*свет': 'light_partition',
    r'партитура.*звук': 'sound_partition',
    r'грим': 'makeup_card',
    r'райдер|rider': 'rider',
    r'смет|калькуляц': 'estimates',
    r'чертеж|drawing': 'drawings',
}

# По расширению файла
EXTENSION_HINTS = {
    '.dwg': 'drawings',
    '.c2p': 'light_partition',
    '.esf3d': 'light_partition',
    '.cues': 'sound_partition',
    '.mp3': 'sound_partition',
    '.wav': 'sound_partition',
    '.xlsx': 'estimates',
}

# По родительской папке
FOLDER_HINTS = {
    'Сертификаты': 'material_certs',
    'Эскизы': 'sketches',
    'Планировки': 'layouts',
    'Чертежи': 'drawings',
    'audio': 'sound_partition',
    'Фотографии': 'decor_photos',
    'сметы': 'estimates',
}
```

---

## 6. Монтировочная опись: структура данных

### Категории инвентаря (из реальных документов)

```typescript
enum MountCategory {
  SOFT_DECOR = '100',      // Мягкие декорации (половик, задник, ковёр)
  HARD_DECOR = '200',      // Жёсткие декорации (стены, потолок, выстилка)
  FURNITURE = '300',       // Мебель (стол, стул)
  PROPS = '400',           // Реквизит (посуда, аксессуары)
  BUTAFORIA = '500',       // Бутафория (декоративные предметы)
  CONSUMABLES = '600',     // Исходящий реквизит (продукты, расходники)
}

interface MountItem {
  code: string;            // "101", "201"
  name: string;            // "Половик"
  quantity: number;        // 1
  unit: string;            // "комплект", "шт.", "пара"
  category: MountCategory;
  performance_id: number;
  notes?: string;
}
```

### Костюмы по персонажам

```typescript
interface CostumeSet {
  character: string;       // "Паратов 1", "Лариса 2"
  actor?: string;          // "Александр Баргман"
  items: CostumeItem[];
}

interface CostumeItem {
  name: string;            // "Рубашка из сорочечной ткани"
  description: string;     // "с длинным рукавом"
  size: string;            // "48", "44", "М"
  quantity: number;        // 1
  unit: string;            // "шт.", "пара", "комп."
}
```

---

## 7. Типы превью для разных форматов

| Формат | Превью | Действие |
|--------|--------|----------|
| PDF | Встроенный просмотрщик (PDF.js) | Скачать, Печать |
| DOCX | Конвертация в HTML или PDF | Скачать, Редактировать |
| XLSX | Табличный просмотрщик | Скачать |
| JPG/PNG | Галерея изображений | Скачать, Увеличить |
| MP3/WAV | Аудиоплеер | Скачать, Воспроизвести |
| MP4 | Видеоплеер | Скачать, Воспроизвести |
| DWG | Иконка + метаданные | Скачать |
| C2P/CUES | Иконка + метаданные | Скачать |

---

## 8. Рекомендации для UI загрузки

### Мобильное устройство (планшет)
- **Камера**: Быстрое фото сертификата/чертежа → авто-категоризация по изображению
- **Drag & Drop**: Из галереи телефона
- **Голосовые команды**: "Добавить фото декораций акт 2"

### ПК (рабочая станция)
- **Bulk Upload**: Загрузка папки целиком с сохранением структуры
- **Drag & Drop**: Из файлового менеджера
- **Импорт из облака**: Yandex.Disk, Google Drive

### Общее
- Автоопределение категории по имени файла и содержимому
- Предложение тегов на основе анализа
- Валидация обязательных документов для раздела

---

## 9. Чеклист готовности спектакля

На основе анализа структуры паспорта:

```yaml
performance_readiness:
  general:
    - title_page: required
    - reception_act: required
    - fire_protection: required
    - welding_acts: if_has_metal
    - material_certs: recommended

  production:
    - sketches: required
    - tech_spec_decor: required
    - tech_spec_light: required
    - tech_spec_costume: required
    - tech_spec_props: recommended

  operation:
    - decor_photos: required
    - layouts: required
    - mount_list_decor: required
    - mount_list_costume: required
    - light_partition: required
    - sound_partition: required
    - makeup_card: if_has_makeup

  appendix:
    - rider: required_for_tour
    - estimates: recommended
```

### Отчёт о готовности (пример)

```
Спектакль: Бесприданница
Готовность: 85%

✅ 1.0 Общая часть (100%)
   ✅ Паспорт спектакля
   ✅ Акт приёмки
   ✅ Огнезащита
   ✅ Сварочные работы
   ✅ Сертификаты материалов

✅ 2.0 Производство (100%)
   ✅ Эскизы
   ✅ ТЗ декорация
   ✅ ТЗ свет
   ✅ ТЗ костюм
   ✅ ТЗ реквизит

⚠️ 3.0 Эксплуатация (75%)
   ✅ Фото декораций
   ✅ Планировки
   ✅ Монтировочные описи
   ❌ Ведомость развески - отсутствует
   ✅ Партитура света
   ⚠️ Партитура звука - нет выписки PDF
   ✅ Грим-карта

✅ 4.0 Приложение (100%)
   ✅ Райдер
   ✅ Сметы
```

---

## 10. Медиа-контент спектакля

### Звуковое оформление
- **Музыкальные треки**: MP3 (основной формат)
- **Звуковые эффекты**: WAV (высокое качество)
- **Проект QLab**: .cues файлы
- **Концепция**: DOCX со списком треков и исполнителей

### Световое оформление
- **Проект Capture**: .c2p файлы
- **Шоу-файл пульта**: .esf3d (ETC)
- **Фото направки/развеса**: JPEG
- **Схемы развески**: PDF

### Видео (опционально)
- **Контент для проекции**: MP4
- **Запись спектакля**: MP4

---

## 11. Следующие шаги для разработки

### Phase 8: Document Management Enhancement

1. **Модель PerformanceDocument**
   - Связь с Performance
   - Категория (enum из п.4)
   - Версионирование
   - Автор загрузки

2. **Auto-categorization Service**
   - Парсинг имени файла
   - Анализ родительской папки
   - OCR для сертификатов (опционально)

3. **Readiness Report**
   - Чеклист по категориям
   - Процент заполнения
   - Список отсутствующих документов

4. **File Preview System**
   - PDF.js для PDF
   - Audio/Video плееры
   - Галерея изображений
   - XLSX просмотрщик

5. **Bulk Upload Interface**
   - Сохранение структуры папок
   - Предпросмотр категоризации
   - Batch редактирование тегов
